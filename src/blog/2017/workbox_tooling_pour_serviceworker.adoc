:doctitle: Tooling pour Service Worker
:description:  Zoom sur workerjs la nouvelle toolbox de Google pour mettre en place des services workers
:keywords: Web, PWA, ServiceWorker
:author: Guillaume EHRET - Dev-Mind
:revdate: 2017-06-21
:category: Web
:teaser: Après avoir rappelé comment fonctionnait les services workers cet article explique comment mettre en place un service worker via la nouvelle toolbox, Workboxjs de Google.
:imgteaser: ../../img/blog/2017/workbox_sw_00.png
:status: draft

Dans https://www.dev-mind.fr/blog/2017/service_worker.html[l'article précédent] je vous ai expliqué comment fonctionnait les services workers et comment ils nous permettaient d'enrichir nos progressive webapps. Nous allons aujourd'hui voir comment ajouter un service worker dans votre application web.

Reprenons le graphique présentant le cycle de vie d'un service worker

image::../../img/blog/2017/service_worker_05.png[Cycle de vie, max-width="700px"]

Dans le cas courant un service worker peut

* référencer toutes les ressources prises en compte par le SW
* écrire un listener sur l'événement _install_ pour installer les dépendances ou pour commencer à peupler des éléments dans le cache
* écrire un listener sur l'événement _activate_ pour nettoyer le cache des ressources qui ne sont plus utilisées. Il est important d'ailleurs que l'id cache de votre service worker soit toujours le même. Sinon ce travail de nettoyage ne pourra pas être effectué. On reviendra un peu plus tard sur les problèmes éventuels avec le cache
* écrire un listener sur l'événement _fetch_ pour interagir avec les requêtes effectuées par l'utilisateur. Vous pouvez définir des stratégies pour privilégier des ressources de votre cache plutôt que les ressources présentes sur votre serveur
* écrire un listener sur l'événement _push_ pour que votre service worker intervienne quand votre serveur https://developer.mozilla.org/en-US/docs/Web/API/PushEvent[pousse] de l'information. Vous pouvez par exemple faire de la notification
* écrire un listener sur l'événement _sync_ pour se https://github.com/WICG/BackgroundSync/blob/master/explainer.md[synchroniser] avec le serveur quand vous retrouvez une connexion Internet

L'écriture du worker en soit peut être assez fastidieuse et source d'erreur si les choses sont mal faites. Google propose donc plusieurs librairies pour vous aider à faire ce travail.

== swprecache et swtoolbox